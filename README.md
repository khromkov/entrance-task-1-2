# Задание 1 — найди ошибки

[DEMO](https://khromkov.github.io/entrance-task-1-2/)

## Решение

1.  Запускаем. В консоле ошибка webpack:

```
"export 'default' (imported as 'initMap') was not found in './map'
```

Ошибка в import/export в index.js/map.js.

Исправляем в src/index.js

```
import { initMap } from "./map";
```

2.  Ошибок в консоли нет. Карта не отображается. Смотрим в инспектор элементов и видим, что высота карты 0. Из документации по карте:

```
Создайте видимый контейнер ненулевого размера
```

Наверное, круто было бы если сама карта кидала в консоль предупреждение: "Высота контейнера 0 и ссылка на доку".
Идем в файл со стилями и правим:

```
html,
body,
#map {
  margin: 0;
  padding: 0;
  height: 100vh;
  width: 100vw;
}
```

Карта открылась, дронов нет.

3.  Поле изучения файла map.js, видно, что objectManager создается, но нигде к карте не добавляется. Пошел смотреть документацию, как это сделать. Страница с живыми примерами https://tech.yandex.ru/maps/jsbox/2.1?from=jsapi помогла мне найти все ответы довольно быстро.

```
myMap.geoObjects.add(objectManager);
```

4.  Дронов на карту по-прежнему нет. По коду кажется все корректно. В инспекторе элементов видно, что они добавились на карту. Смасштабиров карту увидел, что они все где-то в другом месте (не над Москвой). Первая же мысль, перепунаты координыта. В mappers.js исправляем:

```
coordinates: [obj.lat, obj.long]
```

5.  Дроны отобразились. Кластеры тоже есть, но все одно цвета - зеленого. В файле map.js удалил строку:

```
objectManager.clusters.options.set('preset', 'islands#greenClusterIcons');
```

Все заработало как нужно.

6.  Попап с информацией не открывается. В консоле при открытии возниекает ошибка:

```
Uncaught (in promise) TypeError: Cannot read property 'setData' of null
```

и не очень информативный stack trace.
Идем в файл src/details.js, который отвечает за попап. Видим, что создается класс с помощью метода ymaps.templateLayoutFactory.createClass. В параметрах вызова указан объект с двумя методами, которые использую this. Они объявлены как стрелочные функции: возможно проблема в этом, так как контекст при вызове будет некорректным. Иправляем, все работает.

7.  Графиков не видно, хотя компонент добавился без ошибок. Сразу видим, что координаты оси ординат от -1 до 0, что исходя из данных странно. Ищем, где можно установить эти параметры. В src/chart.js:

```
yAxes: [{ ticks: { beginAtZero: true, max: **10** } }]
```

10, так как при генерции данных больше быть не может.

8.  src/popup.js файл нигде не используется: удаляем. Это можно увидеть в сорс мапе в dev tools, которую генерирует webpack. Этот файл не попадает в сборку и его там нет.
9.  Для code-styl'а установил eslint с конфигом airbnb и prettierrc.

## gh-pages

Что собрать проект из залить на gh-pages я сделал следующее:

1.  установил npm gh-pages
2.  отрефакторил backend-stub
3.  написал оберку для window.fetch, чтобы не трогать исходный код в api.js
4.  В зависимости от среды выполнения подключаю оберку из шага 3 в конфиге сборки

## Условие

В этом репозитории находятся материалы тестового задания "Найди ошибки" для [14-й Школы разработки интерфейсов](https://academy.yandex.ru/events/frontend/shri_msk-2018-2) (осень 2018, Москва, Санкт-Петербург, Симферополь).

Для работы тестового приложения нужен Node.JS v9. В проекте используются [Yandex Maps API](https://tech.yandex.ru/maps/doc/jsapi/2.1/quick-start/index-docpage/) и [ChartJS](http://www.chartjs.org).

### Задание

Код содержит ошибки разной степени критичности. Некоторые из них — стилистические, а другие — даже не позволят вам запустить приложение. Вам нужно найти все ошибки и исправить их.

Пункты для самопроверки:

1.  Приложение должно успешно запускаться.
2.  По адресу http://localhost:9000 должна открываться карта с метками.
3.  Должна правильно работать вся функциональность, перечисленная в условиях задания.
4.  Не должно быть лишнего кода.
5.  Все должно быть в едином codestyle.

### Запуск

```
npm i
npm start
```

При каждом запуске тестовые данные генерируются заново случайным образом.
